<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Mobile App Oauth and OpenID Connect - A-ha - Michael&#39;s Personal Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Michael" /><meta name="description" content="Design goal: This SO question is almost all I need, only that I am doing this for a mobile app Web and Mobile client Flask API(middle tier) Session management use two tokens short lived and long lived. After user has logged each subseuqnce api call should use JWT Mobile app use native view to perform third party login(Google/Facebook). User only needs to log in on third party once, and no" /><meta name="keywords" content="A-ha, personal, thoughts, leetcode, lintcode, algorithm, interview" />






<meta name="generator" content="Hugo 0.73.0 with theme even" />


<link rel="canonical" href="http://localhost:1313/post/mobile-app-oauth-and-oidc/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.78f8f17bab244b9ee62ad16480c9584d5fc2db06ae20681d1ca225cefd80767c.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Mobile App Oauth and OpenID Connect" />
<meta property="og:description" content="Design goal: This SO question is almost all I need, only that I am doing this for a mobile app Web and Mobile client Flask API(middle tier) Session management use two tokens short lived and long lived. After user has logged each subseuqnce api call should use JWT Mobile app use native view to perform third party login(Google/Facebook). User only needs to log in on third party once, and no" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/mobile-app-oauth-and-oidc/" />
<meta property="article:published_time" content="2020-06-07T13:39:38-04:00" />
<meta property="article:modified_time" content="2020-06-07T13:39:38-04:00" />
<meta itemprop="name" content="Mobile App Oauth and OpenID Connect">
<meta itemprop="description" content="Design goal: This SO question is almost all I need, only that I am doing this for a mobile app Web and Mobile client Flask API(middle tier) Session management use two tokens short lived and long lived. After user has logged each subseuqnce api call should use JWT Mobile app use native view to perform third party login(Google/Facebook). User only needs to log in on third party once, and no">
<meta itemprop="datePublished" content="2020-06-07T13:39:38-04:00" />
<meta itemprop="dateModified" content="2020-06-07T13:39:38-04:00" />
<meta itemprop="wordCount" content="557">



<meta itemprop="keywords" content="Oauth,OpenID,OIDC,Mobile APP,前后端分离," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Mobile App Oauth and OpenID Connect"/>
<meta name="twitter:description" content="Design goal: This SO question is almost all I need, only that I am doing this for a mobile app Web and Mobile client Flask API(middle tier) Session management use two tokens short lived and long lived. After user has logged each subseuqnce api call should use JWT Mobile app use native view to perform third party login(Google/Facebook). User only needs to log in on third party once, and no"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Michael</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Michael</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Mobile App Oauth and OpenID Connect</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-06-07 </span>
        <div class="post-category">
            <a href="/categories/user/"> User </a>
            <a href="/categories/authentication/"> Authentication </a>
            <a href="/categories/authorization/"> Authorization </a>
            </div>
          <span class="more-meta"> 557 words </span>
          <span class="more-meta"> 2 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#oauth-flow">Oauth Flow</a></li>
    <li><a href="#session-management">Session Management</a></li>
    <li><a href="#graphql">GraphQL</a></li>
    <li><a href="#guest-mode">Guest Mode</a></li>
    <li><a href="#putting-everything-together">Putting Everything Together</a></li>
    <li><a href="#other-possible-combination-of-the-above-techniques">Other Possible Combination of the Above Techniques</a></li>
    <li><a href="#save-user-open-id">Save user open id</a></li>
    <li><a href="#保持用户登录">保持用户登录</a></li>
    <li><a href="#reference">Reference</a></li>
    <li><a href="#what-dri">What dri</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="/img/user-auth-design/login-with-google/login-with-google-v1.png" alt="image"></p>
<p>Design goal:
<a href="https://stackoverflow.com/questions/36751304/jwt-token-strategy-for-frontend-and-backend">This SO question is almost all I need, only that I am doing this for a mobile app</a></p>
<ul>
<li>Web and Mobile client</li>
<li>Flask API(middle tier)</li>
</ul>
<p><a href="https://security.stackexchange.com/questions/220691/backend-authentication-of-mobile-app-session-id-vs-oauth">Session management</a></p>
<ul>
<li>use two tokens short lived and long lived.</li>
</ul>
<p><a href="https://jwt.io/introduction/">After user has logged each subseuqnce api call should use JWT</a></p>
<ul>
<li>Mobile app use native view to perform third party login(Google/Facebook).</li>
<li>User only needs to log in on third party once, and no need to always type in credential.</li>
<li>Web is the easy case because all tutorials takes web auth as example.</li>
<li>Can I set this up in a way to allow Guest Mode? Only asks user to login/register when write action happens(write, comment, like, follow, etc).</li>
</ul>
<p>Some questions:</p>
<ul>
<li>What about GraphQL integration?</li>
<li>After user logged in, what does follow up queries to backend look like? Should I include a session id for each query?</li>
<li>What is the relationship between <code>Session</code>, <code>Access Token</code>, and <code>Authentication Token</code>?</li>
</ul>
<h2 id="oauth-flow">Oauth Flow</h2>
<p><code>access token</code>, <code>PKCE</code>, <code>authentication token</code></p>
<h2 id="session-management">Session Management</h2>
<p><code>flask-login</code>, database table to save <code>User</code> and <code>Session</code>
access_token is saved at middle tier&rsquo;s database.
auth_token no need to be saved. Serverside, using session id to look up the access_token when neede to talk to Provider(G/F).</p>
<h2 id="graphql">GraphQL</h2>
<p><code>flask-alchemy</code></p>
<h2 id="guest-mode">Guest Mode</h2>
<p><code>uuid</code>, save <code>session_id</code> to either KeyStore or cookies etc.</p>
<h2 id="putting-everything-together">Putting Everything Together</h2>
<p>At the mobile client side and web client side, start Oauth flow to get <code>Authentication Token</code> from provider(G/F). Use this to talk to Flask backend, and</p>
<h2 id="other-possible-combination-of-the-above-techniques">Other Possible Combination of the Above Techniques</h2>
<p>When website does not need to Guest mode, what is the recommended way to do things?
When your product needs to support multiple sessions, what do you need to do?</p>
<!-- raw HTML omitted -->
<h2 id="save-user-open-id">Save user open id</h2>
<p><img src="/img/mobile-app-flask-oauth/save_token_and_openid.png" alt="image"></p>
<h2 id="保持用户登录">保持用户登录</h2>
<p>通过back channel来和provider服务器验证的时候获得了openid。
这样子整个验证模式就转化成了session based。客户端（不论是web或者是mobile）只需要保存session_id就行了。
每次访问后端的时候就通过session_id来决定用户是不是已经登陆过了。并且需要查看refresh_token是不是过期。
如果快过期了就续一下。</p>
<h2 id="reference">Reference</h2>
<ol>
<li><a href="https://segmentfault.com/a/1190000013535016">基于token的用户权限认证机制——以微信公众号授权网页为例</a>
<ul>
<li>提纲挈领的文章，直接框定了步骤</li>
</ul>
</li>
</ol>
<h2 id="what-dri">What dri</h2>
<ol>
<li>Why is basic authentication not enough?</li>
<li>I want to support F/G login, what is the minimum work necessary?</li>
<li>What is all these security loop holes? How to avoid them?
<ul>
<li>CSRF: <a href="https://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html">浅谈CSRF攻击</a></li>
<li>XSS: ? supporting material?</li>
</ul>
</li>
</ol>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Michael</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2020-06-07
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/oauth/">Oauth</a>
          <a href="/tags/openid/">OpenID</a>
          <a href="/tags/oidc/">OIDC</a>
          <a href="/tags/mobile-app/">Mobile APP</a>
          <a href="/tags/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/">前后端分离</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/leetcode-weekly-contest-194/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Leetcode Weekly Contest 194</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/leetcode-weekly-contest-192/">
            <span class="next-text nav-default">Leetcode Weekly Contest 192</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'goqqy';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/mkmojo" class="iconfont icon-github" title="github"></a>
  <a href="http://localhost:1313/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2015 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Michael</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script><script></script><script src="https://cdn.jsdelivr.net/npm/raphael@2.2.7/raphael.min.js" integrity="sha256-67By+NpOtm9ka1R6xpUefeGOY8kWWHHRAKlvaTJ7ONI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/flowchart.js@1.8.0/release/flowchart.min.js" integrity="sha256-zNGWjubXoY6rb5MnmpBNefO0RgoVYfle9p0tvOQM+6k=" crossorigin="anonymous"></script><script>window.sequenceDiagramsOptions = {theme: 'simple'};</script><script src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js" integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.js" integrity="sha256-oI+elz+sIm+jpn8F/qEspKoKveTc5uKeFHNNVexe6d8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/underscore@1.8.3/underscore-min.js" integrity="sha256-obZACiHd7gkOk9iIL/pimWMTJ4W/pBsKu+oZnSeBIek=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.js" integrity="sha384-8748Vn52gHJYJI0XEuPB2QlPVNUkJlJn9tHqKec6J3q2r9l8fvRxrgn/E5ZHV0sP" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.css" integrity="sha384-6QbLKJMz5dS3adWSeINZe74uSydBGFbnzaAYmp+tKyq60S7H2p6V7g1TysM5lAaF" crossorigin="anonymous">



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>








</body>
</html>
